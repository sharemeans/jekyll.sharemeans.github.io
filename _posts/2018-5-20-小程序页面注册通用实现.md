---
tags: [小程序]
---

### 前提准备

    1. 小程序每个页面注册的时候调用Page()方法，为了方便添加统一的方法，可以抽离出一个方法封装成一个模块，暴露出P方法
    
{% highlight ruby %}
/**
    *
    * @param options Page注册需要的选项
    * @param mixins [Array] 额外需要注册的自定义函数或者属性
    * @returns {*}
    * @constructor
    */
const P = (options) => {
    let pageOptions = options
    // do something
    return Page(pageOptions);
};

module.exports = P;
{% endhighlight %}


    2. 在每个页面的js文件中，引入这个模块把注册页面需要的参数对象传递给P方法


{% highlight ruby %}
const P = require("../../../framework/page")
P({
    data: {},
    onLoad(){},
    onShow(){}
})
{% endhighlight %}
    
### 场景1：部分页面需要用到的通用方法

    1. 通用方法分离出一个文件作为单独的模块

{% highlight ruby %}
    module.exports = {
        method1() {},
        method2() {}
    }
{% endhighlight %}    

    2. 每个页面引入混合方法, P函数接受mixins数组作为参数用来混合
    
   {% highlight ruby %} 
   ~~~
    /*framework/page.js*/
    /**
     *
     * @param name 页面名称
     * @param options Page注册需要的选项
     * @param mixins [Array] 额外需要注册的自定义函数或者属性
     * @returns {*}
     * @constructor
     */
    const P = (options, mixins) => {
      let pageOptions = options
      // 混合注册方法
      let temp_mixins = {}
      if (mixins && mixins.length) {
        for (let mixin of mixins) {
          Object.assign(temp_mixins, mixin)
        }
        if (Object.keys(temp_mixins).length) {
          Object.assign(pageOptions, temp_mixins)
        }
      }
      return Page(pageOptions);
    };
    
    module.exports = P;
    ---------------文件分割线--------------------
    /*pages/XXX.js*/
    const p = require("../../framework/page");
    const shop = require("../../framework/shop");
    const orders = require("../../framework/orders");
    p({
        data: {},
        onLoad() {},
    }, [shop, orders])

    /*需要注意的是，为了防止出现命名冲突，各个混合的方法名最好加个模块名称的前缀，例如*/
    /*framework/shop.js*/
    module.exports = {
        _shop_method1() {},
        _shop_method2() {}
    }
 ~~~   
 {% endhighlight %} 

### 场景2：页面比较多的情况下，为所有页面的某个生命周期函数添加相同的执行语句，如，添加loading

    1. P函数中重写生命周期方法

{% highlight ruby %} 
     /*framework/page.js*/
    // 重写onShow事件回调
    const showLoading = function () {
      // dosomething
      this.setData({
        key: value
      })
    }
    /**
     *
     * @param name 页面名称
     * @param options Page注册需要的选项
     * @param mixins [Array] 额外需要注册的自定义函数或者属性
     * @returns {*}
     * @constructor
     */
    const P = (options, mixins) => {
      let pageOptions = options
      // onShow执行的时候初始化data变量以及指定播放链接
      if (pageOptions.onShow instanceof Function) {
        let onShow = pageOptions.onShow
        pageOptions.onShow = function () {
          onShow.call(this)
          showLoading.call(this)
        }
      } else {
        pageOptions.onShow = function () {
          showLoading.call(this)
        }
      }
      return Page(pageOptions);
    };
    
    module.exports = P;
{% endhighlight %} 
    